# HarmonySocial

HarmonySocial es una aplicación móvil y web diseñada para unir el aprendizaje musical con la interacción social. El objetivo es democratizar el acceso a la educación musical (alineado con el ODS 4) y ofrecer un espacio donde los usuarios pueden desarrollar sus habilidades, compartir sus creaciones y conectarse con otros músicos, tanto principiantes como expertos.

## Tabla de Contenidos

- [Introducción](#Introducción)
- [Características Principales](#características-principales)
  - [Módulo Social](#módulo-social)
  - [Módulo Educativo](#módulo-educativo)
  - [Gestión de Usuarios](#gestión-de-usuarios)
  - [Validación de Canciones](#validación-de-canciones)
- [Arquitectura y Tecnologías](#arquitectura-y-tecnologías)
  - [Frontend](#frontend)
  - [Backend](#backend)
  - [Base de Datos](#base-de-datos)
- [Estructura de la Base de Datos](#estructura-de-la-base-de-datos)
- [Inspiración](#inspiración)

## Introducción

HarmonySocial combina la pasión por la música con la potencia de la tecnología. La aplicación permite a los usuarios:

- Aprender teoría musical mediante herramientas interactivas, como el Círculo de Quintas.
- Subir y compartir canciones (originales o covers), generando posts con interacciones sociales.
- Conectarse y colaborar con otros músicos mediante likes, comentarios y compartidos.

## Características Principales

### Módulo Social

- **Interacción:** Los usuarios pueden subir canciones, dar likes, comentar, compartir y seguir a otros músicos.
- **Posts:** Cada canción subida genera un post que incluye información del autor, fecha de publicación, descripción y métricas de interacción.

### Módulo Educativo

- **Teoría Musical:** Explicación detallada de canciones que incluye datos sobre tónica, progresión armónica, acordes, BPM, instrumentos y nivel de dificultad.
- **Herramientas Didácticas:** Uso del Círculo de Quintas para enseñar teoría musical de forma interactiva.

### Gestión de Usuarios

- **Perfiles Personalizados:** Cada usuario cuenta con un perfil donde se muestra avatar, canciones subidas, progreso en el aprendizaje y elementos de gamificación.
- **Conexiones Sociales:** Posibilidad de seguir a otros usuarios y formar parte de una comunidad activa.

### Validación de Canciones

- **Verificación Colaborativa:** Las canciones pueden ser validadas tanto por la comunidad como por artistas, aumentando la confiabilidad del contenido.

## Arquitectura y Tecnologías

### Frontend

- **React Native:** Desarrollo de la aplicación móvil con un diseño responsivo y componentes interactivos.
- **Arquitectura MVVM:** Separación clara entre la lógica de negocio (ViewModel), la interfaz (View) y los datos (Model).

### Backend

- **Node.js con Express:** Implementado en TypeScript, utilizando una arquitectura hexagonal (ports & adapters) que desacopla el núcleo de la aplicación de los detalles de infraestructura.
- **Gestión de Errores y Validaciones:** Uso de DTOs para requests/responses y manejo centralizado de errores.

### Base de Datos

- **PostgreSQL:** Diseño de un modelo relacional normalizado con tablas dedicadas a usuarios, artistas, canciones, posts, comentarios, likes, instrumentos y géneros.
- **Integridad y Relaciones:** Implementación de relaciones 1:1 entre canciones y teoría musical, y relaciones 1:N para posts y demás interacciones.

## Estructura de la Base de Datos

El esquema de la base de datos incluye:

- **Usuarios:** Datos de autenticación, perfil y métricas de aprendizaje.
- **Artistas:** Información y verificación de artistas.
- **Canciones y Teoría Musical:** Cada canción cuenta además con un análisis teórico asociado.
- **Posts, Comentarios y Likes:** Registro de la actividad social y de interacción de la comunidad.

Se han implementado además triggers para mantener la integridad de los campos de fecha de actualización en cada tabla.

## Inspiración

HarmonySocial se inspira en la idea de que la música es un lenguaje universal. Así como en una banda cada instrumento aporta su sonido para crear armonía, en esta aplicación cada usuario aporta su talento para construir una comunidad musical diversa e inclusiva.

_Disfruta explorando, aprendiendo y compartiendo en HarmonySocial._

Estructura a seguir para el front (MVVM):
```
/src
│
├── models                     # Modelos (como User.ts, Product.ts)
│
├── services                   # Acceso a APIs u otros recursos
│
├── screens
│   └── Login
│       ├── LoginScreen.tsx    # View (solo UI)
│       ├── LoginViewModel.ts  # Lógica de presentación y binding
│       └── LoginModel.ts      # Modelo específico de vista (opcional)
│
├── components                 # Componentes reutilizables
│
├── navigation                 # Navegación
│
├── hooks                      # Hooks personalizados (ej: useAuth)
│
├── utils                      # Funciones auxiliares
│
└── App.tsx
```
Link de codi.link de la prueba de concepto web [Prueba de concepto](https://codi.link/PGRpdiBjbGFzcz0iY29udGFpbmVyIj4NCiAgPGgxPkPDrXJjdWxvIGRlIFF1aW50YXMgSW50ZXJhY3Rpdm88L2gxPg0KICA8ZGl2IGNsYXNzPSJjYW52YXMtY29udGFpbmVyIj4NCiAgICA8Y2FudmFzIGlkPSJjaXJjbGVDYW52YXMiIHdpZHRoPSI2MDAiIGhlaWdodD0iNjAwIj48L2NhbnZhcz4NCiAgPC9kaXY+DQogIDxkaXYgY2xhc3M9ImluZm8tcGFuZWwiPg0KICAgIDxoMyBpZD0ic2VsZWN0ZWRLZXkiPlNlbGVjY2lvbmEgdW5hIHRvbmFsaWRhZDwvaDM+DQogICAgPGRpdiBpZD0ic2NhbGVOb3RlcyI+PC9kaXY+DQogIDwvZGl2Pg0KPC9kaXY+%7CKiB7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCn0NCg0KYm9keSB7DQogICAgZm9udC1mYW1pbHk6ICdBcmlhbCcsIHNhbnMtc2VyaWY7DQogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzY2N2VlYSAwJSwgIzc2NGJhMiAxMDAlKTsNCiAgICBtaW4taGVpZ2h0OiAxMDB2aDsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQp9DQoNCi5jb250YWluZXIgew0KICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuOTUpOw0KICAgIGJvcmRlci1yYWRpdXM6IDIwcHg7DQogICAgcGFkZGluZzogMzBweDsNCiAgICBib3gtc2hhZG93OiAwIDIwcHggNDBweCByZ2JhKDAsIDAsIDAsIDAuMik7DQogICAgbWF4LXdpZHRoOiA4MDBweDsNCiAgICB3aWR0aDogOTAlOw0KfQ0KDQpoMSB7DQogICAgY29sb3I6ICMzMzM7DQogICAgbWFyZ2luLWJvdHRvbTogMzBweDsNCiAgICBmb250LXNpemU6IDIuNWVtOw0KICAgIGZvbnQtd2VpZ2h0OiAzMDA7DQp9DQoNCi5jYW52YXMtY29udGFpbmVyIHsNCiAgICBtYXJnaW4tYm90dG9tOiAzMHB4Ow0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQp9DQoNCiNjaXJjbGVDYW52YXMgew0KICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICBtYXgtd2lkdGg6IDEwMCU7DQogICAgaGVpZ2h0OiBhdXRvOw0KICAgIC8qIFJlbW92aWRvOiBib3JkZXItcmFkaXVzIHkgYm94LXNoYWRvdyBxdWUgY2F1c2FiYW4gZWwgY8OtcmN1bG8gZXh0cmEgKi8NCn0NCg0KLmluZm8tcGFuZWwgew0KICAgIGJhY2tncm91bmQ6ICNmOGY5ZmE7DQogICAgYm9yZGVyLXJhZGl1czogMTVweDsNCiAgICBwYWRkaW5nOiAyMHB4Ow0KICAgIG1hcmdpbi10b3A6IDIwcHg7DQp9DQoNCiNzZWxlY3RlZEtleSB7DQogICAgY29sb3I6ICM0YTU1Njg7DQogICAgbWFyZ2luLWJvdHRvbTogMTVweDsNCiAgICBmb250LXNpemU6IDEuOGVtOw0KfQ0KDQojc2NhbGVOb3RlcyB7DQogICAgY29sb3I6ICM2NjY7DQogICAgZm9udC1zaXplOiAxLjJlbTsNCiAgICBsaW5lLWhlaWdodDogMS42Ow0KfQ0KDQpAbWVkaWEgKG1heC13aWR0aDogNzY4cHgpIHsNCiAgICAuY29udGFpbmVyIHsNCiAgICAgICAgd2lkdGg6IDk1JTsNCiAgICAgICAgcGFkZGluZzogMjBweDsNCiAgICB9DQogICAgDQogICAgaDEgew0KICAgICAgICBmb250LXNpemU6IDJlbTsNCiAgICB9DQogICAgDQogICAgI2NpcmNsZUNhbnZhcyB7DQogICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICBtYXgtd2lkdGg6IDQwMHB4Ow0KICAgIH0NCn0=%7CY2xhc3MgQ2lyY2xlT2ZGaWZ0aHMgew0KICBjb25zdHJ1Y3RvcihjYW52YXNJZCkgew0KICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2FudmFzSWQpOw0KICAgIHRoaXMuY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICB0aGlzLmNlbnRlclggPSB0aGlzLmNhbnZhcy53aWR0aCAvIDI7DQogICAgdGhpcy5jZW50ZXJZID0gdGhpcy5jYW52YXMuaGVpZ2h0IC8gMjsNCiAgICB0aGlzLm91dGVyUmFkaXVzID0gMjIwOw0KICAgIHRoaXMuaW5uZXJSYWRpdXMgPSAxNjA7DQogICAgdGhpcy5taWRkbGVSYWRpdXMgPSA5MDsNCiAgICB0aGlzLnNlbGVjdGVkS2V5ID0gbnVsbDsNCg0KICAgIC8vIEPDrXJjdWxvIGRlIHF1aW50YXMgb3JkZW5hZG8gY29ycmVjdGFtZW50ZSAtIERvIGFycmliYQ0KICAgIHRoaXMubWFqb3JLZXlzID0gWw0KICAgICAgJ0MnLCAnRycsICdEJywgJ0EnLCAnRScsICdCJywgJ0YjL0diJywgJ0RiJywgJ0FiJywgJ0ViJywgJ0JiJywgJ0YnDQogICAgXTsNCg0KICAgIHRoaXMubWlub3JLZXlzID0gWw0KICAgICAgJ0FtJywgJ0VtJywgJ0JtJywgJ0YjbScsICdDI20nLCAnRyNtJywgJ0VibScsICdCYm0nLCAnRm0nLCAnQ20nLCAnR20nLCAnRG0nDQogICAgXTsNCg0KICAgIC8vIEVzdHJ1Y3R1cmEgZGUgZXNjYWxhcyBjb24gYWNvcmRlcyBjb21wbGV0b3MgeSBpZFBvc2l0aW9uDQogICAgdGhpcy5zY2FsZURhdGEgPSBbDQogICAgICB7DQogICAgICAgIGtleTogJ0MnLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnSScsIG5vdGU6ICdDJywgaWRQb3NpdGlvbjogJzBlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdpaScsIG5vdGU6ICdEbScsIGlkUG9zaXRpb246ICcxMWknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2lpaScsIG5vdGU6ICdFbScsIGlkUG9zaXRpb246ICcxaScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnSVYnLCBub3RlOiAnRicsIGlkUG9zaXRpb246ICcxMWUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ1YnLCBub3RlOiAnRycsIGlkUG9zaXRpb246ICcxZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAndmknLCBub3RlOiAnQW0nLCBpZFBvc2l0aW9uOiAnMGknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ3ZpacKwJywgbm90ZTogJ0JtJywgaWRQb3NpdGlvbjogJzJpJyB9DQogICAgICAgIF0NCiAgICAgIH0sDQogICAgICB7DQogICAgICAgIGtleTogJ0cnLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnSScsIG5vdGU6ICdHJywgaWRQb3NpdGlvbjogJzFlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdpaScsIG5vdGU6ICdBbScsIGlkUG9zaXRpb246ICcwaScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaWlpJywgbm90ZTogJ0JtJywgaWRQb3NpdGlvbjogJzJpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdJVicsIG5vdGU6ICdDJywgaWRQb3NpdGlvbjogJzBlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdWJywgbm90ZTogJ0QnLCBpZFBvc2l0aW9uOiAnMmUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ3ZpJywgbm90ZTogJ0VtJywgaWRQb3NpdGlvbjogJzFpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICd2aWknLCBub3RlOiAnRiMnLCBpZFBvc2l0aW9uOiAnM2knIH0NCiAgICAgICAgXQ0KICAgICAgfSwNCiAgICAgIHsNCiAgICAgICAga2V5OiAnRCcsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgIHsgcG9zaXRpb246ICdJJywgbm90ZTogJ0QnLCBpZFBvc2l0aW9uOiAnMmUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2lpJywgbm90ZTogJ0VtJywgaWRQb3NpdGlvbjogJzFpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdpaWknLCBub3RlOiAnRiNtJywgaWRQb3NpdGlvbjogJzNpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdJVicsIG5vdGU6ICdHJywgaWRQb3NpdGlvbjogJzFlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdWJywgbm90ZTogJ0EnLCBpZFBvc2l0aW9uOiAnM2UnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ3ZpJywgbm90ZTogJ0JtJywgaWRQb3NpdGlvbjogJzJpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICd2aWnCsCcsIG5vdGU6ICdDI8KwJywgaWRQb3NpdGlvbjogJzRpJyB9DQogICAgICAgIF0NCiAgICAgIH0sDQogICAgICB7DQogICAgICAgIGtleTogJ0EnLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnSScsIG5vdGU6ICdBJywgaWRQb3NpdGlvbjogJzNlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdpaScsIG5vdGU6ICdCbScsIGlkUG9zaXRpb246ICcyaScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaWlpJywgbm90ZTogJ0MjbScsIGlkUG9zaXRpb246ICc0aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnSVYnLCBub3RlOiAnRCcsIGlkUG9zaXRpb246ICcyZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnVicsIG5vdGU6ICdFJywgaWRQb3NpdGlvbjogJzRlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICd2aScsIG5vdGU6ICdGI20nLCBpZFBvc2l0aW9uOiAnM2knIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ3ZpacKwJywgbm90ZTogJ0cjwrAnLCBpZFBvc2l0aW9uOiAnNWknIH0NCiAgICAgICAgXQ0KICAgICAgfSwNCiAgICAgIHsNCiAgICAgICAga2V5OiAnRScsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgIHsgcG9zaXRpb246ICdJJywgbm90ZTogJ0UnLCBpZFBvc2l0aW9uOiAnNGUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2lpJywgbm90ZTogJ0YjbScsIGlkUG9zaXRpb246ICczaScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaWlpJywgbm90ZTogJ0cjbScsIGlkUG9zaXRpb246ICc1aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnSVYnLCBub3RlOiAnQScsIGlkUG9zaXRpb246ICczZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnVicsIG5vdGU6ICdCJywgaWRQb3NpdGlvbjogJzVlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICd2aScsIG5vdGU6ICdDI20nLCBpZFBvc2l0aW9uOiAnNGknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ3ZpacKwJywgbm90ZTogJ0QjwrAnLCBpZFBvc2l0aW9uOiAnNmknIH0NCiAgICAgICAgXQ0KICAgICAgfSwNCiAgICAgIHsNCiAgICAgICAga2V5OiAnQicsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgIHsgcG9zaXRpb246ICdJJywgbm90ZTogJ0InLCBpZFBvc2l0aW9uOiAnNWUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2lpJywgbm90ZTogJ0MjbScsIGlkUG9zaXRpb246ICc0aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaWlpJywgbm90ZTogJ0QjbScsIGlkUG9zaXRpb246ICc2aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnSVYnLCBub3RlOiAnRScsIGlkUG9zaXRpb246ICc0ZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnVicsIG5vdGU6ICdGIycsIGlkUG9zaXRpb246ICc2ZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAndmknLCBub3RlOiAnRyNtJywgaWRQb3NpdGlvbjogJzVpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICd2aWnCsCcsIG5vdGU6ICdBI8KwJywgaWRQb3NpdGlvbjogJzdpJyB9DQogICAgICAgIF0NCiAgICAgIH0sDQogICAgICB7DQogICAgICAgIGtleTogJ0YjL0diJywNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgeyBwb3NpdGlvbjogJ0knLCBub3RlOiAnRiMnLCBpZFBvc2l0aW9uOiAnNmUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2lpJywgbm90ZTogJ0cjbScsIGlkUG9zaXRpb246ICc1aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaWlpJywgbm90ZTogJ0EjbScsIGlkUG9zaXRpb246ICc3aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnSVYnLCBub3RlOiAnQicsIGlkUG9zaXRpb246ICc1ZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnVicsIG5vdGU6ICdDIycsIGlkUG9zaXRpb246ICc3ZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAndmknLCBub3RlOiAnRCNtJywgaWRQb3NpdGlvbjogJzZpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICd2aWnCsCcsIG5vdGU6ICdGbcKwJywgaWRQb3NpdGlvbjogJzhpJyB9DQogICAgICAgIF0NCiAgICAgIH0sDQogICAgICB7DQogICAgICAgIGtleTogJ0RiJywNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgeyBwb3NpdGlvbjogJ0knLCBub3RlOiAnRGInLCBpZFBvc2l0aW9uOiAnN2UnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2lpJywgbm90ZTogJ0VibScsIGlkUG9zaXRpb246ICc2aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaWlpJywgbm90ZTogJ0ZtJywgaWRQb3NpdGlvbjogJzhpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdJVicsIG5vdGU6ICdHYicsIGlkUG9zaXRpb246ICc2ZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnVicsIG5vdGU6ICdBYicsIGlkUG9zaXRpb246ICc4ZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAndmknLCBub3RlOiAnQmJtJywgaWRQb3NpdGlvbjogJzdpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICd2aWnCsCcsIG5vdGU6ICdDbcKwJywgaWRQb3NpdGlvbjogJzlpJyB9DQogICAgICAgIF0NCiAgICAgIH0sDQogICAgICB7DQogICAgICAgIGtleTogJ0FiJywNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgeyBwb3NpdGlvbjogJ0knLCBub3RlOiAnQWInLCBpZFBvc2l0aW9uOiAnOGUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2lpJywgbm90ZTogJ0JibScsIGlkUG9zaXRpb246ICc3aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaWlpJywgbm90ZTogJ0NtJywgaWRQb3NpdGlvbjogJzlpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdJVicsIG5vdGU6ICdEYicsIGlkUG9zaXRpb246ICc3ZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnVicsIG5vdGU6ICdFYicsIGlkUG9zaXRpb246ICc5ZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAndmknLCBub3RlOiAnRm0nLCBpZFBvc2l0aW9uOiAnOGknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ3ZpacKwJywgbm90ZTogJ0dtwrAnLCBpZFBvc2l0aW9uOiAnMTBpJyB9DQogICAgICAgIF0NCiAgICAgIH0sDQogICAgICB7DQogICAgICAgIGtleTogJ0ViJywNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgeyBwb3NpdGlvbjogJ0knLCBub3RlOiAnRWInLCBpZFBvc2l0aW9uOiAnOWUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2lpJywgbm90ZTogJ0ZtJywgaWRQb3NpdGlvbjogJzhpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdpaWknLCBub3RlOiAnR20nLCBpZFBvc2l0aW9uOiAnMTBpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdJVicsIG5vdGU6ICdBYicsIGlkUG9zaXRpb246ICc4ZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnVicsIG5vdGU6ICdCYicsIGlkUG9zaXRpb246ICcxMGUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ3ZpJywgbm90ZTogJ0NtJywgaWRQb3NpdGlvbjogJzlpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICd2aWnCsCcsIG5vdGU6ICdEbcKwJywgaWRQb3NpdGlvbjogJzExaScgfQ0KICAgICAgICBdDQogICAgICB9LA0KICAgICAgew0KICAgICAgICBrZXk6ICdCYicsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgIHsgcG9zaXRpb246ICdJJywgbm90ZTogJ0JiJywgaWRQb3NpdGlvbjogJzEwZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaWknLCBub3RlOiAnQ20nLCBpZFBvc2l0aW9uOiAnOWknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2lpaScsIG5vdGU6ICdEbScsIGlkUG9zaXRpb246ICcxMWknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ0lWJywgbm90ZTogJ0ViJywgaWRQb3NpdGlvbjogJzllJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdWJywgbm90ZTogJ0YnLCBpZFBvc2l0aW9uOiAnMTFlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICd2aScsIG5vdGU6ICdHbScsIGlkUG9zaXRpb246ICcxMGknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ3ZpacKwJywgbm90ZTogJ0FtwrAnLCBpZFBvc2l0aW9uOiAnMGknIH0NCiAgICAgICAgXQ0KICAgICAgfSwNCiAgICAgIHsNCiAgICAgICAga2V5OiAnRicsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgIHsgcG9zaXRpb246ICdJJywgbm90ZTogJ0YnLCBpZFBvc2l0aW9uOiAnMTFlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdpaScsIG5vdGU6ICdHbScsIGlkUG9zaXRpb246ICcxMGknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2lpaScsIG5vdGU6ICdBbScsIGlkUG9zaXRpb246ICcwaScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnSVYnLCBub3RlOiAnQmInLCBpZFBvc2l0aW9uOiAnMTBlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdWJywgbm90ZTogJ0MnLCBpZFBvc2l0aW9uOiAnMGUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ3ZpJywgbm90ZTogJ0RtJywgaWRQb3NpdGlvbjogJzExaScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAndmlpwrAnLCBub3RlOiAnRcKwJywgaWRQb3NpdGlvbjogJzFpJyB9DQogICAgICAgIF0NCiAgICAgIH0sDQogICAgICAvLyBFc2NhbGFzIG1lbm9yZXMNCiAgICAgIHsNCiAgICAgICAga2V5OiAnQW0nLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaScsIG5vdGU6ICdBbScsIGlkUG9zaXRpb246ICcwaScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaWnCsCcsIG5vdGU6ICdCwrAnLCBpZFBvc2l0aW9uOiAnMmknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ0lJSScsIG5vdGU6ICdDJywgaWRQb3NpdGlvbjogJzBlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdpdicsIG5vdGU6ICdEbScsIGlkUG9zaXRpb246ICcxMWknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ3YnLCBub3RlOiAnRW0nLCBpZFBvc2l0aW9uOiAnMWknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ1ZJJywgbm90ZTogJ0YnLCBpZFBvc2l0aW9uOiAnMTFlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdWSUknLCBub3RlOiAnRycsIGlkUG9zaXRpb246ICcxZScgfQ0KICAgICAgICBdDQogICAgICB9LA0KICAgICAgew0KICAgICAgICBrZXk6ICdFbScsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgIHsgcG9zaXRpb246ICdpJywgbm90ZTogJ0VtJywgaWRQb3NpdGlvbjogJzFpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdpacKwJywgbm90ZTogJ0JtwrAnLCBpZFBvc2l0aW9uOiAnM2knIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ0lJSScsIG5vdGU6ICdHJywgaWRQb3NpdGlvbjogJzFlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdpdicsIG5vdGU6ICdBbScsIGlkUG9zaXRpb246ICcwaScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAndicsIG5vdGU6ICdCbScsIGlkUG9zaXRpb246ICcyaScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnVkknLCBub3RlOiAnQycsIGlkUG9zaXRpb246ICcwZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnVklJJywgbm90ZTogJ0QnLCBpZFBvc2l0aW9uOiAnMmUnIH0NCiAgICAgICAgXQ0KICAgICAgfSwNCiAgICAgIHsNCiAgICAgICAga2V5OiAnQm0nLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaScsIG5vdGU6ICdCbScsIGlkUG9zaXRpb246ICcyaScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaWnCsCcsIG5vdGU6ICdDI8KwJywgaWRQb3NpdGlvbjogJzRpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdJSUknLCBub3RlOiAnRCcsIGlkUG9zaXRpb246ICcyZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaXYnLCBub3RlOiAnRW0nLCBpZFBvc2l0aW9uOiAnMWknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ3YnLCBub3RlOiAnRiNtJywgaWRQb3NpdGlvbjogJzNpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdWSScsIG5vdGU6ICdHJywgaWRQb3NpdGlvbjogJzFlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdWSUknLCBub3RlOiAnQScsIGlkUG9zaXRpb246ICczZScgfQ0KICAgICAgICBdDQogICAgICB9LA0KICAgICAgew0KICAgICAgICBrZXk6ICdGI20nLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaScsIG5vdGU6ICdGI20nLCBpZFBvc2l0aW9uOiAnM2knIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2lpwrAnLCBub3RlOiAnRyPCsCcsIGlkUG9zaXRpb246ICc1aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnSUlJJywgbm90ZTogJ0EnLCBpZFBvc2l0aW9uOiAnM2UnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2l2Jywgbm90ZTogJ0JtJywgaWRQb3NpdGlvbjogJzJpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICd2Jywgbm90ZTogJ0MjbScsIGlkUG9zaXRpb246ICc0aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnVkknLCBub3RlOiAnRCcsIGlkUG9zaXRpb246ICcyZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnVklJJywgbm90ZTogJ0UnLCBpZFBvc2l0aW9uOiAnNGUnIH0NCiAgICAgICAgXQ0KICAgICAgfSwNCiAgICAgIHsNCiAgICAgICAga2V5OiAnQyNtJywNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2knLCBub3RlOiAnQyNtJywgaWRQb3NpdGlvbjogJzRpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdpacKwJywgbm90ZTogJ0QjwrAnLCBpZFBvc2l0aW9uOiAnNmknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ0lJSScsIG5vdGU6ICdFJywgaWRQb3NpdGlvbjogJzRlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdpdicsIG5vdGU6ICdGI20nLCBpZFBvc2l0aW9uOiAnM2knIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ3YnLCBub3RlOiAnRyNtJywgaWRQb3NpdGlvbjogJzVpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdWSScsIG5vdGU6ICdBJywgaWRQb3NpdGlvbjogJzNlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdWSUknLCBub3RlOiAnQicsIGlkUG9zaXRpb246ICc1ZScgfQ0KICAgICAgICBdDQogICAgICB9LA0KICAgICAgew0KICAgICAgICBrZXk6ICdHI20nLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaScsIG5vdGU6ICdHI20nLCBpZFBvc2l0aW9uOiAnNWknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2lpwrAnLCBub3RlOiAnRm3CsCcsIGlkUG9zaXRpb246ICc3aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnSUlJJywgbm90ZTogJ0InLCBpZFBvc2l0aW9uOiAnNWUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2l2Jywgbm90ZTogJ0MjbScsIGlkUG9zaXRpb246ICc0aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAndicsIG5vdGU6ICdEI20nLCBpZFBvc2l0aW9uOiAnNmknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ1ZJJywgbm90ZTogJ0UnLCBpZFBvc2l0aW9uOiAnNGUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ1ZJSScsIG5vdGU6ICdGIycsIGlkUG9zaXRpb246ICc2ZScgfQ0KICAgICAgICBdDQogICAgICB9LA0KICAgICAgew0KICAgICAgICBrZXk6ICdFYm0nLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaScsIG5vdGU6ICdFYm0nLCBpZFBvc2l0aW9uOiAnNmknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2lpwrAnLCBub3RlOiAnRsKwJywgaWRQb3NpdGlvbjogJzhpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdJSUknLCBub3RlOiAnR2InLCBpZFBvc2l0aW9uOiAnNmUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2l2Jywgbm90ZTogJ0FibScsIGlkUG9zaXRpb246ICc1aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAndicsIG5vdGU6ICdCYm0nLCBpZFBvc2l0aW9uOiAnN2knIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ1ZJJywgbm90ZTogJ0NiJywgaWRQb3NpdGlvbjogJzVlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdWSUknLCBub3RlOiAnRGInLCBpZFBvc2l0aW9uOiAnN2UnIH0NCiAgICAgICAgXQ0KICAgICAgfSwNCiAgICAgIHsNCiAgICAgICAga2V5OiAnQmJtJywNCiAgICAgICAgdmFsdWVzOiBbDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2knLCBub3RlOiAnQmJtJywgaWRQb3NpdGlvbjogJzdpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdpacKwJywgbm90ZTogJ0PCsCcsIGlkUG9zaXRpb246ICc5aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnSUlJJywgbm90ZTogJ0RiJywgaWRQb3NpdGlvbjogJzdlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdpdicsIG5vdGU6ICdFYm0nLCBpZFBvc2l0aW9uOiAnNmknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ3YnLCBub3RlOiAnRm0nLCBpZFBvc2l0aW9uOiAnOGknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ1ZJJywgbm90ZTogJ0diJywgaWRQb3NpdGlvbjogJzZlJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdWSUknLCBub3RlOiAnQWInLCBpZFBvc2l0aW9uOiAnOGUnIH0NCiAgICAgICAgXQ0KICAgICAgfSwNCiAgICAgIHsNCiAgICAgICAga2V5OiAnRm0nLA0KICAgICAgICB2YWx1ZXM6IFsNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaScsIG5vdGU6ICdGbScsIGlkUG9zaXRpb246ICc4aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaWnCsCcsIG5vdGU6ICdHwrAnLCBpZFBvc2l0aW9uOiAnMTBpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdJSUknLCBub3RlOiAnQWInLCBpZFBvc2l0aW9uOiAnOGUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2l2Jywgbm90ZTogJ0JibScsIGlkUG9zaXRpb246ICc3aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAndicsIG5vdGU6ICdDbScsIGlkUG9zaXRpb246ICc5aScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnVkknLCBub3RlOiAnRGInLCBpZFBvc2l0aW9uOiAnN2UnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ1ZJSScsIG5vdGU6ICdFYicsIGlkUG9zaXRpb246ICc5ZScgfQ0KICAgICAgICBdDQogICAgICB9LA0KICAgICAgew0KICAgICAgICBrZXk6ICdDbScsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgIHsgcG9zaXRpb246ICdpJywgbm90ZTogJ0NtJywgaWRQb3NpdGlvbjogJzlpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdpacKwJywgbm90ZTogJ0TCsCcsIGlkUG9zaXRpb246ICcxMWknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ0lJSScsIG5vdGU6ICdFYicsIGlkUG9zaXRpb246ICc5ZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaXYnLCBub3RlOiAnRm0nLCBpZFBvc2l0aW9uOiAnOGknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ3YnLCBub3RlOiAnR20nLCBpZFBvc2l0aW9uOiAnMTBpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdWSScsIG5vdGU6ICdBYicsIGlkUG9zaXRpb246ICc4ZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnVklJJywgbm90ZTogJ0JiJywgaWRQb3NpdGlvbjogJzEwZScgfQ0KICAgICAgICBdDQogICAgICB9LA0KICAgICAgew0KICAgICAgICBrZXk6ICdHbScsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgIHsgcG9zaXRpb246ICdpJywgbm90ZTogJ0dtJywgaWRQb3NpdGlvbjogJzEwaScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaWnCsCcsIG5vdGU6ICdBwrAnLCBpZFBvc2l0aW9uOiAnMGknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ0lJSScsIG5vdGU6ICdCYicsIGlkUG9zaXRpb246ICcxMGUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ2l2Jywgbm90ZTogJ0NtJywgaWRQb3NpdGlvbjogJzlpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICd2Jywgbm90ZTogJ0RtJywgaWRQb3NpdGlvbjogJzExaScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnVkknLCBub3RlOiAnRWInLCBpZFBvc2l0aW9uOiAnOWUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ1ZJSScsIG5vdGU6ICdGJywgaWRQb3NpdGlvbjogJzExZScgfQ0KICAgICAgICBdDQogICAgICB9LA0KICAgICAgew0KICAgICAgICBrZXk6ICdEbScsDQogICAgICAgIHZhbHVlczogWw0KICAgICAgICAgIHsgcG9zaXRpb246ICdpJywgbm90ZTogJ0RtJywgaWRQb3NpdGlvbjogJzExaScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaWnCsCcsIG5vdGU6ICdFwrAnLCBpZFBvc2l0aW9uOiAnMWknIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ0lJSScsIG5vdGU6ICdGJywgaWRQb3NpdGlvbjogJzExZScgfSwNCiAgICAgICAgICB7IHBvc2l0aW9uOiAnaXYnLCBub3RlOiAnR20nLCBpZFBvc2l0aW9uOiAnMTBpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICd2Jywgbm90ZTogJ0FtJywgaWRQb3NpdGlvbjogJzBpJyB9LA0KICAgICAgICAgIHsgcG9zaXRpb246ICdWSScsIG5vdGU6ICdCYicsIGlkUG9zaXRpb246ICcxMGUnIH0sDQogICAgICAgICAgeyBwb3NpdGlvbjogJ1ZJSScsIG5vdGU6ICdDJywgaWRQb3NpdGlvbjogJzBlJyB9DQogICAgICAgIF0NCiAgICAgIH0NCiAgICBdOw0KDQogICAgdGhpcy5pbml0KCk7DQogIH0NCg0KICBpbml0KCkgew0KICAgIHRoaXMuZHJhdygpOw0KICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHRoaXMuaGFuZGxlQ2xpY2soZSkpOw0KICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIChlKSA9PiB0aGlzLmhhbmRsZU1vdXNlTW92ZShlKSk7DQogIH0NCg0KICBkcmF3KCkgew0KICAgIHRoaXMuY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0KTsNCg0KICAgIC8vIERpYnVqYXIgc2VnbWVudG9zDQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMjsgaSsrKSB7DQogICAgICB0aGlzLmRyYXdTZWdtZW50KGksIHRoaXMubWFqb3JLZXlzW2ldLCB0aGlzLm1pbm9yS2V5c1tpXSk7DQogICAgfQ0KDQogICAgLy8gRGlidWphciBuw7ptZXJvcyBkZSBncmFkbyBzaSBoYXkgdW5hIHRvbmFsaWRhZCBzZWxlY2Npb25hZGENCiAgICBpZiAodGhpcy5zZWxlY3RlZEtleSkgew0KICAgICAgdGhpcy5kcmF3U2NhbGVEZWdyZWVzKCk7DQogICAgfQ0KDQogICAgLy8gRGlidWphciBjw61yY3VsbyBjZW50cmFsDQogICAgdGhpcy5kcmF3Q2VudGVyQ2lyY2xlKCk7DQogIH0NCg0KICBkcmF3U2VnbWVudChpbmRleCwgbWFqb3JLZXksIG1pbm9yS2V5KSB7DQogICAgLy8gUm90YWNpw7NuIGNvcnJlZ2lkYTogRG8gYXJyaWJhICjDrW5kaWNlIDAgPSAyNzDCsCkNCiAgICBjb25zdCBzdGFydEFuZ2xlID0gKGluZGV4ICogMzAgLSA5MCkgKiAoTWF0aC5QSSAvIDE4MCk7DQogICAgY29uc3QgZW5kQW5nbGUgPSAoKGluZGV4ICsgMSkgKiAzMCAtIDkwKSAqIChNYXRoLlBJIC8gMTgwKTsNCg0KICAgIGNvbnN0IGlzU2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGVkS2V5ID09PSBtYWpvcktleSB8fCB0aGlzLnNlbGVjdGVkS2V5ID09PSBtaW5vcktleTsNCiAgICBjb25zdCBpc0luU2NhbGUgPSB0aGlzLmlzS2V5SW5TZWxlY3RlZFNjYWxlKG1ham9yS2V5KSB8fCB0aGlzLmlzS2V5SW5TZWxlY3RlZFNjYWxlKG1pbm9yS2V5KTsNCg0KICAgIC8vIENvbG9yZXMNCiAgICBsZXQgb3V0ZXJDb2xvciA9IGlzU2VsZWN0ZWQgPyAnIzRDQUY1MCcgOiBpc0luU2NhbGUgPyAnIzgxQzc4NCcgOiAnI0UwRTBFMCc7DQogICAgbGV0IGlubmVyQ29sb3IgPSBpc1NlbGVjdGVkID8gJyMyRTdEMzInIDogaXNJblNjYWxlID8gJyM2NkJCNkEnIDogJyNCREJEQkQnOw0KDQogICAgaWYgKHRoaXMuc2VsZWN0ZWRLZXkgJiYgIWlzU2VsZWN0ZWQgJiYgIWlzSW5TY2FsZSkgew0KICAgICAgb3V0ZXJDb2xvciA9ICcjRjVGNUY1JzsNCiAgICAgIGlubmVyQ29sb3IgPSAnI0VFRUVFRSc7DQogICAgfQ0KDQogICAgLy8gRGlidWphciBzZWdtZW50byBleHRlcmlvciAodG9uYWxpZGFkZXMgbWF5b3JlcykNCiAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBvdXRlckNvbG9yOw0KICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpOw0KICAgIHRoaXMuY3R4LmFyYyh0aGlzLmNlbnRlclgsIHRoaXMuY2VudGVyWSwgdGhpcy5vdXRlclJhZGl1cywgc3RhcnRBbmdsZSwgZW5kQW5nbGUpOw0KICAgIHRoaXMuY3R4LmFyYyh0aGlzLmNlbnRlclgsIHRoaXMuY2VudGVyWSwgdGhpcy5pbm5lclJhZGl1cywgZW5kQW5nbGUsIHN0YXJ0QW5nbGUsIHRydWUpOw0KICAgIHRoaXMuY3R4LmNsb3NlUGF0aCgpOw0KICAgIHRoaXMuY3R4LmZpbGwoKTsNCg0KICAgIC8vIERpYnVqYXIgc2VnbWVudG8gaW50ZXJpb3IgKHRvbmFsaWRhZGVzIG1lbm9yZXMpDQogICAgdGhpcy5jdHguZmlsbFN0eWxlID0gaW5uZXJDb2xvcjsNCiAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTsNCiAgICB0aGlzLmN0eC5hcmModGhpcy5jZW50ZXJYLCB0aGlzLmNlbnRlclksIHRoaXMuaW5uZXJSYWRpdXMsIHN0YXJ0QW5nbGUsIGVuZEFuZ2xlKTsNCiAgICB0aGlzLmN0eC5hcmModGhpcy5jZW50ZXJYLCB0aGlzLmNlbnRlclksIHRoaXMubWlkZGxlUmFkaXVzLCBlbmRBbmdsZSwgc3RhcnRBbmdsZSwgdHJ1ZSk7DQogICAgdGhpcy5jdHguY2xvc2VQYXRoKCk7DQogICAgdGhpcy5jdHguZmlsbCgpOw0KDQogICAgLy8gRGlidWphciBib3JkZXMNCiAgICB0aGlzLmN0eC5zdHJva2VTdHlsZSA9ICcjRkZGRkZGJzsNCiAgICB0aGlzLmN0eC5saW5lV2lkdGggPSAyOw0KICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpOw0KICAgIHRoaXMuY3R4LmFyYyh0aGlzLmNlbnRlclgsIHRoaXMuY2VudGVyWSwgdGhpcy5vdXRlclJhZGl1cywgc3RhcnRBbmdsZSwgZW5kQW5nbGUpOw0KICAgIHRoaXMuY3R4LmFyYyh0aGlzLmNlbnRlclgsIHRoaXMuY2VudGVyWSwgdGhpcy5pbm5lclJhZGl1cywgZW5kQW5nbGUsIHN0YXJ0QW5nbGUsIHRydWUpOw0KICAgIHRoaXMuY3R4LmNsb3NlUGF0aCgpOw0KICAgIHRoaXMuY3R4LnN0cm9rZSgpOw0KDQogICAgdGhpcy5jdHguYmVnaW5QYXRoKCk7DQogICAgdGhpcy5jdHguYXJjKHRoaXMuY2VudGVyWCwgdGhpcy5jZW50ZXJZLCB0aGlzLmlubmVyUmFkaXVzLCBzdGFydEFuZ2xlLCBlbmRBbmdsZSk7DQogICAgdGhpcy5jdHguYXJjKHRoaXMuY2VudGVyWCwgdGhpcy5jZW50ZXJZLCB0aGlzLm1pZGRsZVJhZGl1cywgZW5kQW5nbGUsIHN0YXJ0QW5nbGUsIHRydWUpOw0KICAgIHRoaXMuY3R4LmNsb3NlUGF0aCgpOw0KICAgIHRoaXMuY3R4LnN0cm9rZSgpOw0KDQogICAgLy8gRGlidWphciBsw61uZWFzIGRpdmlzb3JpYXMgcmFkaWFsZXMNCiAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTsNCiAgICBjb25zdCB4MSA9IHRoaXMuY2VudGVyWCArIE1hdGguY29zKHN0YXJ0QW5nbGUpICogdGhpcy5taWRkbGVSYWRpdXM7DQogICAgY29uc3QgeTEgPSB0aGlzLmNlbnRlclkgKyBNYXRoLnNpbihzdGFydEFuZ2xlKSAqIHRoaXMubWlkZGxlUmFkaXVzOw0KICAgIGNvbnN0IHgyID0gdGhpcy5jZW50ZXJYICsgTWF0aC5jb3Moc3RhcnRBbmdsZSkgKiB0aGlzLm91dGVyUmFkaXVzOw0KICAgIGNvbnN0IHkyID0gdGhpcy5jZW50ZXJZICsgTWF0aC5zaW4oc3RhcnRBbmdsZSkgKiB0aGlzLm91dGVyUmFkaXVzOw0KICAgIHRoaXMuY3R4Lm1vdmVUbyh4MSwgeTEpOw0KICAgIHRoaXMuY3R4LmxpbmVUbyh4MiwgeTIpOw0KICAgIHRoaXMuY3R4LnN0cm9rZSgpOw0KDQogICAgLy8gRGlidWphciB0ZXh0byBjZW50cmFkbyBlbiBjYWRhIHNlZ21lbnRvDQogICAgdGhpcy5kcmF3VGV4dChtYWpvcktleSwgaW5kZXgsIHRoaXMub3V0ZXJSYWRpdXMsIHRoaXMuaW5uZXJSYWRpdXMsIGlzU2VsZWN0ZWQgfHwgaXNJblNjYWxlKTsNCiAgICB0aGlzLmRyYXdUZXh0KG1pbm9yS2V5LCBpbmRleCwgdGhpcy5pbm5lclJhZGl1cywgdGhpcy5taWRkbGVSYWRpdXMsIGlzU2VsZWN0ZWQgfHwgaXNJblNjYWxlKTsNCiAgfQ0KDQogIGRyYXdUZXh0KHRleHQsIGluZGV4LCBvdXRlclIsIGlubmVyUiwgaGlnaGxpZ2h0ZWQpIHsNCiAgICAvLyDDgW5ndWxvIGRlbCBjZW50cm8gZGVsIHNlZ21lbnRvDQogICAgY29uc3Qgc2VnbWVudENlbnRlckFuZ2xlID0gKGluZGV4ICogMzAgKyAxNSAtIDkwKSAqIChNYXRoLlBJIC8gMTgwKTsNCiAgICBjb25zdCByYWRpdXMgPSAob3V0ZXJSICsgaW5uZXJSKSAvIDI7DQogICAgY29uc3QgeCA9IHRoaXMuY2VudGVyWCArIE1hdGguY29zKHNlZ21lbnRDZW50ZXJBbmdsZSkgKiByYWRpdXM7DQogICAgY29uc3QgeSA9IHRoaXMuY2VudGVyWSArIE1hdGguc2luKHNlZ21lbnRDZW50ZXJBbmdsZSkgKiByYWRpdXM7DQoNCiAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBoaWdobGlnaHRlZCA/ICcjRkZGRkZGJyA6ICcjMzMzMzMzJzsNCiAgICB0aGlzLmN0eC5mb250ID0gaGlnaGxpZ2h0ZWQgPyAnYm9sZCAxNnB4IEFyaWFsJyA6ICcxNHB4IEFyaWFsJzsNCiAgICB0aGlzLmN0eC50ZXh0QWxpZ24gPSAnY2VudGVyJzsNCiAgICB0aGlzLmN0eC50ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJzsNCiAgICB0aGlzLmN0eC5maWxsVGV4dCh0ZXh0LCB4LCB5KTsNCiAgfQ0KDQogIGRyYXdTY2FsZURlZ3JlZXMoKSB7DQogICAgY29uc3Qgc2VsZWN0ZWRTY2FsZSA9IHRoaXMuc2NhbGVEYXRhLmZpbmQoc2NhbGUgPT4gc2NhbGUua2V5ID09PSB0aGlzLnNlbGVjdGVkS2V5KTsNCiAgICBpZiAoIXNlbGVjdGVkU2NhbGUpIHJldHVybjsNCg0KICAgIC8vIERpYnVqYXIgY8OtcmN1bG9zIGFtYXJpbGxvcyB1c2FuZG8gaWRQb3NpdGlvbg0KICAgIHNlbGVjdGVkU2NhbGUudmFsdWVzLmZvckVhY2goc2NhbGVDaG9yZCA9PiB7DQogICAgICBjb25zdCBpZFBvc2l0aW9uID0gc2NhbGVDaG9yZC5pZFBvc2l0aW9uOw0KICAgICAgY29uc3QgcG9zaXRpb25JbmRleCA9IHBhcnNlSW50KGlkUG9zaXRpb24uc3Vic3RyaW5nKDAsIGlkUG9zaXRpb24ubGVuZ3RoIC0gMSkpOw0KICAgICAgY29uc3QgaXNFeHRlcm5hbCA9IGlkUG9zaXRpb24uZW5kc1dpdGgoJ2UnKTsNCg0KICAgICAgY29uc3Qgc2VnbWVudENlbnRlckFuZ2xlID0gKHBvc2l0aW9uSW5kZXggKiAzMCArIDE1IC0gOTApICogKE1hdGguUEkgLyAxODApOw0KICAgICAgbGV0IHJhZGl1czsNCg0KICAgICAgaWYgKGlzRXh0ZXJuYWwpIHsNCiAgICAgICAgcmFkaXVzID0gKHRoaXMub3V0ZXJSYWRpdXMgKyB0aGlzLmlubmVyUmFkaXVzKSAvIDI7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByYWRpdXMgPSAodGhpcy5pbm5lclJhZGl1cyArIHRoaXMubWlkZGxlUmFkaXVzKSAvIDI7DQogICAgICB9DQoNCiAgICAgIGNvbnN0IHggPSB0aGlzLmNlbnRlclggKyBNYXRoLmNvcyhzZWdtZW50Q2VudGVyQW5nbGUpICogcmFkaXVzOw0KICAgICAgY29uc3QgeSA9IHRoaXMuY2VudGVyWSArIE1hdGguc2luKHNlZ21lbnRDZW50ZXJBbmdsZSkgKiByYWRpdXM7DQoNCiAgICAgIC8vIERpYnVqYXIgY8OtcmN1bG8gYW1hcmlsbG8NCiAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9ICcjRkZENzAwJzsNCiAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpOw0KICAgICAgdGhpcy5jdHguYXJjKHgsIHkgLSAyMCwgMTIsIDAsIDIgKiBNYXRoLlBJKTsNCiAgICAgIHRoaXMuY3R4LmZpbGwoKTsNCg0KICAgICAgLy8gRGlidWphciBib3JkZQ0KICAgICAgdGhpcy5jdHguc3Ryb2tlU3R5bGUgPSAnI0ZGQTUwMCc7DQogICAgICB0aGlzLmN0eC5saW5lV2lkdGggPSAyOw0KICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7DQoNCiAgICAgIC8vIERpYnVqYXIgbsO6bWVybyByb21hbm8NCiAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZSA9ICcjMDAwMDAwJzsNCiAgICAgIHRoaXMuY3R4LmZvbnQgPSAnYm9sZCA5cHggQXJpYWwnOw0KICAgICAgdGhpcy5jdHgudGV4dEFsaWduID0gJ2NlbnRlcic7DQogICAgICB0aGlzLmN0eC50ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJzsNCiAgICAgIHRoaXMuY3R4LmZpbGxUZXh0KHNjYWxlQ2hvcmQucG9zaXRpb24sIHgsIHkgLSAyMCk7DQogICAgfSk7DQogIH0NCg0KICBkcmF3Q2VudGVyQ2lyY2xlKCkgew0KICAgIGNvbnN0IGdyYWRpZW50ID0gdGhpcy5jdHguY3JlYXRlUmFkaWFsR3JhZGllbnQoDQogICAgICB0aGlzLmNlbnRlclgsIHRoaXMuY2VudGVyWSwgMCwNCiAgICAgIHRoaXMuY2VudGVyWCwgdGhpcy5jZW50ZXJZLCB0aGlzLm1pZGRsZVJhZGl1cw0KICAgICk7DQogICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAsICcjZmZmZmZmJyk7DQogICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsICcjZjBmMGYwJyk7DQoNCiAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBncmFkaWVudDsNCiAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTsNCiAgICB0aGlzLmN0eC5hcmModGhpcy5jZW50ZXJYLCB0aGlzLmNlbnRlclksIHRoaXMubWlkZGxlUmFkaXVzLCAwLCAyICogTWF0aC5QSSk7DQogICAgdGhpcy5jdHguZmlsbCgpOw0KDQogICAgdGhpcy5jdHguc3Ryb2tlU3R5bGUgPSAnI0NDQ0NDQyc7DQogICAgdGhpcy5jdHgubGluZVdpZHRoID0gMjsNCiAgICB0aGlzLmN0eC5zdHJva2UoKTsNCiAgfQ0KDQogIGlzS2V5SW5TZWxlY3RlZFNjYWxlKGtleSkgew0KICAgIGNvbnN0IHNlbGVjdGVkU2NhbGUgPSB0aGlzLnNjYWxlRGF0YS5maW5kKHNjYWxlID0+IHNjYWxlLmtleSA9PT0gdGhpcy5zZWxlY3RlZEtleSk7DQogICAgaWYgKCFzZWxlY3RlZFNjYWxlKSByZXR1cm4gZmFsc2U7DQoNCiAgICBjb25zdCBrZXlSb290ID0ga2V5LnJlcGxhY2UoJ20nLCAnJykucmVwbGFjZSgnL0diJywgJycpLnJlcGxhY2UoJy9GIycsICcnKTsNCg0KICAgIHJldHVybiBzZWxlY3RlZFNjYWxlLnZhbHVlcy5zb21lKHNjYWxlQ2hvcmQgPT4gew0KICAgICAgY29uc3QgY2hvcmRSb290ID0gc2NhbGVDaG9yZC5ub3RlLnJlcGxhY2UoJ20nLCAnJykucmVwbGFjZSgnwrAnLCAnJyk7DQogICAgICByZXR1cm4gdGhpcy5ub3RlRXF1YWxzKGNob3JkUm9vdCwga2V5Um9vdCk7DQogICAgfSk7DQogIH0NCg0KICBub3RlRXF1YWxzKG5vdGUxLCBub3RlMikgew0KICAgIGNvbnN0IGNsZWFuTm90ZTEgPSBub3RlMS5yZXBsYWNlKCcjJywgJycpLnJlcGxhY2UoJ2InLCAnJyk7DQogICAgY29uc3QgY2xlYW5Ob3RlMiA9IG5vdGUyLnJlcGxhY2UoJyMnLCAnJykucmVwbGFjZSgnYicsICcnKTsNCiAgICByZXR1cm4gY2xlYW5Ob3RlMSA9PT0gY2xlYW5Ob3RlMiB8fA0KICAgICAgbm90ZTEgPT09IG5vdGUyICsgJyMnIHx8DQogICAgICBub3RlMSA9PT0gbm90ZTIgKyAnYicgfHwNCiAgICAgIG5vdGUyID09PSBub3RlMSArICcjJyB8fA0KICAgICAgbm90ZTIgPT09IG5vdGUxICsgJ2InIHx8DQogICAgICAobm90ZTEgPT09ICdGIycgJiYgbm90ZTIgPT09ICdHYicpIHx8DQogICAgICAobm90ZTEgPT09ICdHYicgJiYgbm90ZTIgPT09ICdGIycpOw0KICB9DQoNCiAgaGFuZGxlQ2xpY2soZXZlbnQpIHsNCiAgICBjb25zdCByZWN0ID0gdGhpcy5jYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgY29uc3Qgc2NhbGVYID0gdGhpcy5jYW52YXMud2lkdGggLyByZWN0LndpZHRoOw0KICAgIGNvbnN0IHNjYWxlWSA9IHRoaXMuY2FudmFzLmhlaWdodCAvIHJlY3QuaGVpZ2h0Ow0KDQogICAgY29uc3QgeCA9IChldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0KSAqIHNjYWxlWDsNCiAgICBjb25zdCB5ID0gKGV2ZW50LmNsaWVudFkgLSByZWN0LnRvcCkgKiBzY2FsZVk7DQoNCiAgICBjb25zdCBkeCA9IHggLSB0aGlzLmNlbnRlclg7DQogICAgY29uc3QgZHkgPSB5IC0gdGhpcy5jZW50ZXJZOw0KICAgIGNvbnN0IGRpc3RhbmNlID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsNCg0KICAgIGlmIChkaXN0YW5jZSA+PSB0aGlzLm1pZGRsZVJhZGl1cyAmJiBkaXN0YW5jZSA8PSB0aGlzLm91dGVyUmFkaXVzKSB7DQogICAgICAvLyBDYWxjdWxhciDDoW5ndWxvIHkgYWp1c3RhciBwYXJhIHF1ZSAwwrAgc2VhIGFycmliYQ0KICAgICAgbGV0IGFuZ2xlID0gTWF0aC5hdGFuMihkeSwgZHgpICogKDE4MCAvIE1hdGguUEkpOw0KICAgICAgYW5nbGUgPSAoYW5nbGUgKyA5MCArIDM2MCkgJSAzNjA7DQogICAgICBjb25zdCBzZWdtZW50ID0gTWF0aC5mbG9vcihhbmdsZSAvIDMwKTsNCg0KICAgICAgaWYgKGRpc3RhbmNlIDw9IHRoaXMuaW5uZXJSYWRpdXMpIHsNCiAgICAgICAgLy8gQ8OtcmN1bG8gaW50ZXJubyAobWVub3JlcykNCiAgICAgICAgdGhpcy5zZWxlY3RlZEtleSA9IHRoaXMubWlub3JLZXlzW3NlZ21lbnRdOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8gQ8OtcmN1bG8gZXh0ZXJubyAobWF5b3JlcykNCiAgICAgICAgdGhpcy5zZWxlY3RlZEtleSA9IHRoaXMubWFqb3JLZXlzW3NlZ21lbnRdOw0KICAgICAgfQ0KDQogICAgICB0aGlzLmRyYXcoKTsNCiAgICAgIHRoaXMudXBkYXRlSW5mb1BhbmVsKCk7DQogICAgfSBlbHNlIGlmIChkaXN0YW5jZSA8IHRoaXMubWlkZGxlUmFkaXVzKSB7DQogICAgICAvLyBDbGljayBlbiBlbCBjZW50cm8gLSByZXNldGVhciBzZWxlY2Npw7NuDQogICAgICB0aGlzLnNlbGVjdGVkS2V5ID0gbnVsbDsNCiAgICAgIHRoaXMuZHJhdygpOw0KICAgICAgdGhpcy51cGRhdGVJbmZvUGFuZWwoKTsNCiAgICB9DQogIH0NCg0KICBoYW5kbGVNb3VzZU1vdmUoZXZlbnQpIHsNCiAgICBjb25zdCByZWN0ID0gdGhpcy5jYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgY29uc3Qgc2NhbGVYID0gdGhpcy5jYW52YXMud2lkdGggLyByZWN0LndpZHRoOw0KICAgIGNvbnN0IHNjYWxlWSA9IHRoaXMuY2FudmFzLmhlaWdodCAvIHJlY3QuaGVpZ2h0Ow0KDQogICAgY29uc3QgeCA9IChldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0KSAqIHNjYWxlWDsNCiAgICBjb25zdCB5ID0gKGV2ZW50LmNsaWVudFkgLSByZWN0LnRvcCkgKiBzY2FsZVk7DQoNCiAgICBjb25zdCBkeCA9IHggLSB0aGlzLmNlbnRlclg7DQogICAgY29uc3QgZHkgPSB5IC0gdGhpcy5jZW50ZXJZOw0KICAgIGNvbnN0IGRpc3RhbmNlID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsNCg0KICAgIGlmIChkaXN0YW5jZSA+PSB0aGlzLm1pZGRsZVJhZGl1cyAmJiBkaXN0YW5jZSA8PSB0aGlzLm91dGVyUmFkaXVzKSB7DQogICAgICB0aGlzLmNhbnZhcy5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7DQogICAgfSBlbHNlIHsNCiAgICAgIHRoaXMuY2FudmFzLnN0eWxlLmN1cnNvciA9ICdkZWZhdWx0JzsNCiAgICB9DQogIH0NCg0KICB1cGRhdGVJbmZvUGFuZWwoKSB7DQogICAgY29uc3Qgc2VsZWN0ZWRLZXlFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWxlY3RlZEtleScpOw0KICAgIGNvbnN0IHNjYWxlTm90ZXNFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2FsZU5vdGVzJyk7DQoNCiAgICBpZiAodGhpcy5zZWxlY3RlZEtleSkgew0KICAgICAgc2VsZWN0ZWRLZXlFbC50ZXh0Q29udGVudCA9IGBUb25hbGlkYWQgc2VsZWNjaW9uYWRhOiAke3RoaXMuc2VsZWN0ZWRLZXl9YDsNCiAgICAgIGNvbnN0IHNlbGVjdGVkU2NhbGUgPSB0aGlzLnNjYWxlRGF0YS5maW5kKHNjYWxlID0+IHNjYWxlLmtleSA9PT0gdGhpcy5zZWxlY3RlZEtleSk7DQogICAgICBpZiAoc2VsZWN0ZWRTY2FsZSkgew0KICAgICAgICBzY2FsZU5vdGVzRWwuaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPkFjb3JkZXMgZGUgbGEgZXNjYWxhOjwvc3Ryb25nPjxicj4NCiAgICAgICAgICAgICAgICAgICAgJHtzZWxlY3RlZFNjYWxlLnZhbHVlcy5tYXAoY2hvcmQgPT4gYCR7Y2hvcmQucG9zaXRpb259OiAke2Nob3JkLm5vdGV9YCkuam9pbignIC0gJyl9DQogICAgICAgICAgICAgICAgYDsNCiAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgc2VsZWN0ZWRLZXlFbC50ZXh0Q29udGVudCA9ICdTZWxlY2Npb25hIHVuYSB0b25hbGlkYWQnOw0KICAgICAgc2NhbGVOb3Rlc0VsLnRleHRDb250ZW50ID0gJ0hheiBjbGljIGVuIGN1YWxxdWllciBzZWdtZW50byBkZWwgY8OtcmN1bG8gcGFyYSB2ZXIgc3UgZXNjYWxhJzsNCiAgICB9DQogIH0NCn0NCg0KLy8gSW5pY2lhbGl6YXIgY3VhbmRvIHNlIGNhcmdhIGxhIHDDoWdpbmENCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7DQogIG5ldyBDaXJjbGVPZkZpZnRocygnY2lyY2xlQ2FudmFzJyk7DQp9KTs=)
